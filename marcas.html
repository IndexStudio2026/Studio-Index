<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Index | Private Label</title>
    <link rel="stylesheet" href="style.css">

    <link rel="icon" type="image/png" href="images/index 16x16x.png">

    <link rel="apple-touch-icon" href="images/index 16x16x.png">

    <meta property="og:site_name" content="Studio Index">
    <meta property="og:title" content="Studio Index | Private Label">
    <meta property="og:image" content="https://studioindex.com.br/images/index 16x16x.png">
    <meta property="og:type" content="website">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <style>
        /* CSS PARA O SLIDESHOW NO CARD */
        .image-container {
            position: relative;
            width: 100%;
            height: 350px;
            overflow: hidden;
            background: #F9FAFB;
        }

        .card-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #F9FAFB;
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
        }

        .card-image.active {
            opacity: 1;
        }

        .card-tag {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            font-size: 0.7rem;
            z-index: 10;
            text-transform: uppercase;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">
            <a href="index.html">
                <img src="images/uploaded_image_1767635167797.png" alt="Studio Index Logo">
            </a>
        </div>
        <nav class="header-nav">
            <a href="index.html" class="nav-link">Home</a>
            <a href="marcas.html" class="nav-link active">Moda</a>
            <a href="corporativo.html" class="nav-link">Empresas</a>
        </nav>
        <a href="javascript:void(0)" onclick="openLeadModal('Contato Geral Marcas')" class="header-cta">Contato</a>
    </header>

    <div class="catalog-header">
        <h2>Coleção Private Label</h2>
        <p>Streetwear e alta moda para sua marca</p>
    </div>

    <nav class="filter-bar" id="dynamic-filters">
        <button class="filter-btn active" onclick="filterProducts('all', event)">Todos</button>
    </nav>

    <main class="product-grid" id="product-container">
        <p style="text-align: center; color: white; grid-column: 1/-1; padding: 50px;">Carregando coleção...</p>
    </main>

    <section class="clients-section">
        <div class="clients-carousel-container">
            <div class="clients-carousel-track" id="logo-track">
            </div>
        </div>
        <style>
            .clients-section {
                overflow: hidden;
            }

            .clients-carousel-container {
                overflow-x: auto;
                overflow-y: hidden;
                padding: 5px 0;
                cursor: grab;
                /* Hide scrollbar */
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            .clients-carousel-container::-webkit-scrollbar {
                display: none;
            }

            .clients-carousel-container:active {
                cursor: grabbing;
            }

            .clients-carousel-track {
                display: flex;
                gap: 30px;
                width: max-content;
                padding: 10px 0;
                /* Animation removed for JS control */
            }

            .clients-carousel-track .client-item {
                flex-shrink: 0;
                overflow: visible;
                user-select: none;
                /* Prevent image selection while dragging */
            }

            .clients-carousel-track .client-item img {
                pointer-events: none;
                /* Prevent image drag behavior */
            }
        </style>
    </section>

    <section class="about-section">
        <div class="about-content">
            <h2>Streetwear Excellence</h2>
            <h3>Alta malharia e Private Label de alto padrão.</h3>
            <p>Com mais de uma década de experiência, transformamos tendências globais em coleções impecáveis.
                Nossa produção une tecnologia de ponta e curadoria de tecidos para marcas que buscam o topo do mercado
                streetwear.</p>
            <div class="about-pillars">
                <div class="pillar-item">
                    <h4>Malhas Premium</h4>
                    <p>Algodão de alta gramatura e toques exclusivos.</p>
                </div>
                <div class="pillar-item">
                    <h4>Private Label</h4>
                    <p>Solução completa: do design à entrega final.</p>
                </div>
            </div>
        </div>
        <div class="about-image">
            <img src="images/sabota.png" alt="Produção Streetwear Studio Index">
        </div>
    </section>

    <div id="lead-modal-overlay" class="lead-modal-overlay">
        <div class="lead-modal">
            <button class="lead-modal-close" onclick="closeLeadModal()">&times;</button>
            <div class="lead-modal-icon">
                <svg fill="currentColor" width="30" height="30" viewBox="0 0 24 24">
                    <path
                        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
                </svg>
            </div>
            <h3>Fale Conosco</h3>
            <p>Deixe seu WhatsApp para iniciar seu projeto de Private Label.</p>
            <div class="lead-input-group">
                <input type="tel" id="user-phone" class="lead-input" placeholder="(00) 00000-0000" maxlength="15">
            </div>
            <button class="lead-submit-btn" onclick="submitLead()">Falar com Especialista</button>
        </div>
    </div>

    <script>
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let rotationInterval;
        let categoriesList = [];

        // FUNÇÕES DO MODAL
        function openLeadModal(title) {
            window.currentLeadProduct = title;
            const modal = document.getElementById('lead-modal-overlay');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('active'), 10);
            }
        }

        function closeLeadModal() {
            const modal = document.getElementById('lead-modal-overlay');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.style.display = 'none', 300);
            }
        }

        async function submitLead() {
            const phoneInput = document.getElementById('user-phone');
            const phone = phoneInput ? phoneInput.value : "";
            if (phone.length < 14) return alert('Por favor, insira um WhatsApp válido.');

            try {
                await _supabase.from('leads').insert([
                    { telefone: phone, nome_produto: `MARCAS: ${window.currentLeadProduct}` }
                ]);
                const msg = encodeURIComponent(`Olá! Gostaria de falar sobre Private Label: ${window.currentLeadProduct}`);
                window.open(`https://wa.me/5528999763505?text=${msg}`, '_blank');
                closeLeadModal();
            } catch (e) {
                window.open(`https://wa.me/5528999763505`, '_blank');
            }
        }

        async function loadFilters() {
            const { data: cats } = await _supabase.from('categorias').select('*').eq('tipo', 'streetwear').order('nome');
            if (cats) {
                categoriesList = cats;
                const filterBar = document.getElementById('dynamic-filters');
                cats.forEach(cat => {
                    const btn = document.createElement('button');
                    btn.className = 'filter-btn';
                    btn.textContent = cat.nome;
                    btn.onclick = (e) => filterProducts(cat.slug, e);
                    filterBar.appendChild(btn);
                });
            }
        }

        async function renderCatalog() {
            const container = document.getElementById('product-container');
            try {
                await loadFilters();
                const { data: products, error } = await _supabase.from('produtos').select('*').eq('categoria', 'streetwear').order('created_at', { ascending: false });
                if (error) throw error;
                if (!products || products.length === 0) {
                    container.innerHTML = '<p style="color: white; text-align: center; grid-column: 1/-1;">Nenhum produto cadastrado.</p>';
                    return;
                }
                container.innerHTML = '';
                products.forEach(p => {
                    const fotos = (p.fotos && p.fotos.length > 0) ? p.fotos : ['images/placeholder.png'];
                    const imagensHtml = fotos.map((url, index) => `<img src="${url}" class="card-image ${index === 0 ? 'active' : ''}" data-index="${index}">`).join('');
                    const catObj = categoriesList.find(c => c.slug === p.tag_personalizacao);
                    const displayTag = catObj ? catObj.nome : (p.tag_personalizacao || 'Streetwear');

                    container.innerHTML += `
                        <a href="product-detail.html?id=${p.id}" class="product-card-link" style="text-decoration: none; color: inherit;">
                            <div class="product-card" data-subtag="${(p.tag_personalizacao || '').toLowerCase()}" onmouseenter="startRotation(this)" onmouseleave="stopRotation(this)">
                                <div class="image-container">
                                    <span class="card-tag">${displayTag}</span>
                                    ${imagensHtml}
                                </div>
                                <div class="card-content">
                                    <h3 class="card-title">${p.nome}</h3>
                                    <span class="card-tap-info">Ver Detalhes →</span>
                                </div>
                            </div>
                        </a>`;
                });
            } catch (err) {
                container.innerHTML = '<p style="color: red; text-align: center; grid-column: 1/-1;">Erro ao carregar dados.</p>';
            }
        }

        function startRotation(card) {
            const images = card.querySelectorAll('.card-image');
            if (images.length <= 1) return;
            let currentIndex = 0;
            clearInterval(rotationInterval);
            rotationInterval = setInterval(() => {
                images[currentIndex].classList.remove('active');
                currentIndex = (currentIndex + 1) % images.length;
                images[currentIndex].classList.add('active');
            }, 1000);
        }

        function stopRotation(card) {
            clearInterval(rotationInterval);
            const images = card.querySelectorAll('.card-image');
            images.forEach((img, index) => {
                img.classList.remove('active');
                if (index === 0) img.classList.add('active');
            });
        }

        function filterProducts(slug, event) {
            const cards = document.querySelectorAll('.product-card-link');
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            cards.forEach(card => {
                const tag = card.querySelector('.product-card').getAttribute('data-subtag');
                card.style.display = (slug === 'all' || tag === slug.toLowerCase()) ? 'block' : 'none';
            });
        }

        async function loadClientLogos() {
            const track = document.getElementById('logo-track');
            if (!track) return;
            try {
                const { data } = await _supabase.from('site_config').select('*').eq('id', 'client_logos').maybeSingle();
                const logos = data?.data?.brand_logos || [];
                if (logos.length === 0) {
                    document.querySelector('.clients-section').style.display = 'none';
                    return;
                }
                // Duplicar logos muitas vezes (8x) para criar um buffer enorme
                // Isso garante que o usuário nunca chegue na borda "0" fisicamente
                // E a lógica de loop o mantém sempre no meio
                const logosHtml = logos.map(url => `<div class="client-item"><img src="${url}" alt="Logo Parceiro"></div>`).join('');
                let finalHtml = '';
                for (let i = 0; i < 12; i++) { // 12x para garantir muito espaço
                    finalHtml += logosHtml;
                }
                track.innerHTML = finalHtml;

                initCarousel();
            } catch (e) { console.error("Erro logos:", e); }
        }

        function initCarousel() {
            const container = document.querySelector('.clients-carousel-container');
            const track = document.getElementById('logo-track');
            if (!container || !track) return;

            let isDown = false;
            let startX;
            let scrollLeft;
            // Velocidade controlada
            let autoScrollSpeed = window.innerWidth < 768 ? 0.5 : 0.3;
            let isPaused = false;
            let animationId;
            let scrollAccumulator = 0; // Acumulador para fluidez em baixa velocidade

            // Aguarda renderização para posicionar no meio exato
            setTimeout(() => {
                const middle = track.scrollWidth / 2;
                container.scrollLeft = middle;
            }, 100);

            // Drag Mouse Events
            container.addEventListener('mousedown', (e) => {
                isDown = true;
                isPaused = true;
                container.classList.add('active');
                startX = e.pageX - container.offsetLeft;
                scrollLeft = container.scrollLeft;
                cancelAnimationFrame(animationId);
            });

            container.addEventListener('mouseleave', () => {
                isDown = false;
                isPaused = false;
                container.classList.remove('active');
                cancelAnimationFrame(animationId); // Stop existing loop if any
                animationId = requestAnimationFrame(animateScroll);
            });

            container.addEventListener('mouseup', () => {
                isDown = false;
                isPaused = false;
                container.classList.remove('active');
                cancelAnimationFrame(animationId); // Stop existing loop if any
                animationId = requestAnimationFrame(animateScroll);
            });

            container.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - container.offsetLeft;
                const walk = (x - startX) * 2;
                container.scrollLeft = scrollLeft - walk;
            });

            // Touch Events (Mobile)
            container.addEventListener('touchstart', () => {
                isPaused = true;
                cancelAnimationFrame(animationId);
            });

            container.addEventListener('touchend', () => {
                isPaused = false;
                cancelAnimationFrame(animationId); // Stop existing loop if any
                animationId = requestAnimationFrame(animateScroll);
            });

            // Auto Scroll Function com Loop Infinito Bidirecional
            function animateScroll() {
                const totalWidth = track.scrollWidth;
                const oneSetWidth = totalWidth / 12; // Já que duplicamos 12x

                if (!isPaused) {
                    // Acumula frações de pixel
                    scrollAccumulator += autoScrollSpeed;

                    // Só aplica se acumulou pelo menos 0.5px (ou 1px para ser seguro)
                    if (Math.abs(scrollAccumulator) >= 0.5) {
                        container.scrollLeft += scrollAccumulator;
                        scrollAccumulator = 0; // Reseta acumulador
                    }
                }

                // Lógica de centralização ("Infinite Loop")
                // Mantém o scroll sempre entre 1/3 e 2/3 do total
                // Se for muito para esquerda (< 4 sets), joga para o meio
                if (container.scrollLeft < oneSetWidth * 4) {
                    container.scrollLeft += oneSetWidth * 4;
                }
                // Se for muito para direita (> 8 sets), traz para o meio
                else if (container.scrollLeft > oneSetWidth * 8) {
                    container.scrollLeft -= oneSetWidth * 4;
                }

                animationId = requestAnimationFrame(animateScroll);
            }

            // Start Animation
            cancelAnimationFrame(animationId); // Ensure clean start
            animationId = requestAnimationFrame(animateScroll);
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderCatalog();
            loadClientLogos();
            const phoneInput = document.getElementById('user-phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', (e) => {
                    let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
                    e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
                });
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.shiftKey && (e.key === 'L' || e.key === 'l')) window.location.href = 'admin.html';
        });
    </script>
</body>

</html>