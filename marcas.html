<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Index | Private Label</title>
    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <style>
        /* CSS PARA O SLIDESHOW NO CARD */
        .image-container {
            position: relative;
            width: 100%;
            height: 350px;
            overflow: hidden;
            background: #F9FAFB;
        }

        .card-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #F9FAFB;
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
        }

        .card-image.active {
            opacity: 1;
        }

        .card-tag {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            font-size: 0.7rem;
            z-index: 10;
            text-transform: uppercase;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">
            <a href="index.html">
                <img src="images/uploaded_image_1767635167797.png" alt="Studio Index Logo">
            </a>
        </div>
        <nav class="header-nav">
            <a href="index.html" class="nav-link">Home</a>
            <a href="marcas.html" class="nav-link active">Marca</a>
            <a href="corporativo.html" class="nav-link">Empresa</a>
        </nav>
        <a href="#" onclick="openLeadModal('Contato Geral'); return false;" class="header-cta">Contato</a>
    </header>

    <div class="catalog-header">
        <h2>Coleção Private Label</h2>
        <p>Streetwear e alta moda para sua marca</p>
    </div>

    <nav class="filter-bar" id="dynamic-filters">
        <button class="filter-btn active" onclick="filterProducts('all', event)">Todos</button>
    </nav>

    <main class="product-grid" id="product-container">
        <p style="text-align: center; color: white; grid-column: 1/-1; padding: 50px;">Carregando coleção...</p>
    </main>

    <section class="clients-section">
        <div class="clients-carousel-container">
            <div class="clients-carousel-track" id="logo-track">
                <!-- Logos dinâmicas -->
            </div>
        </div>
    </section>

    <section class="about-section">
        <div class="about-content">
            <h2>Streetwear Excellence</h2>
            <h3>Alta malharia e Private Label de alto padrão.</h3>
            <p>Com mais de uma década de experiência, transformamos tendências globais em coleções impecáveis.
                Nossa produção une tecnologia de ponta e curadoria de tecidos para marcas que buscam o topo do mercado
                streetwear.</p>
            <div class="about-pillars">
                <div class="pillar-item">
                    <h4>Malhas Premium</h4>
                    <p>Algodão de alta gramatura e toques exclusivos.</p>
                </div>
                <div class="pillar-item">
                    <h4>Private Label</h4>
                    <p>Solução completa: do design à entrega final.</p>
                </div>
            </div>
        </div>
        <div class="about-image">
            <img src="images/streetwear_hoodie_1767633991018.png" alt="Produção Streetwear Studio Index">
        </div>
    </section>

    <script>
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let rotationInterval;
        let categoriesList = [];

        // 1. CARREGA OS FILTROS DO BANCO
        async function loadFilters() {
            const { data: cats } = await _supabase
                .from('categorias')
                .select('*')
                .eq('tipo', 'streetwear')
                .order('nome');

            if (cats) {
                categoriesList = cats;
                const filterBar = document.getElementById('dynamic-filters');
                cats.forEach(cat => {
                    const btn = document.createElement('button');
                    btn.className = 'filter-btn';
                    btn.textContent = cat.nome;
                    btn.onclick = (e) => filterProducts(cat.slug, e);
                    filterBar.appendChild(btn);
                });
            }
        }

        // 2. RENDERIZA O CATÁLOGO
        async function renderCatalog() {
            const container = document.getElementById('product-container');
            try {
                // Carrega filtros primeiro
                await loadFilters();

                const { data: products, error } = await _supabase
                    .from('produtos')
                    .select('*')
                    .eq('categoria', 'streetwear')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!products || products.length === 0) {
                    container.innerHTML = '<p style="color: white; text-align: center; grid-column: 1/-1;">Nenhum produto cadastrado.</p>';
                    return;
                }

                container.innerHTML = '';
                products.forEach(p => {
                    const fotos = (p.fotos && p.fotos.length > 0) ? p.fotos : ['images/placeholder.png'];
                    const imagensHtml = fotos.map((url, index) => `
                        <img src="${url}" class="card-image ${index === 0 ? 'active' : ''}" data-index="${index}">
                    `).join('');

                    // Busca o nome legível da categoria baseado no slug
                    const catObj = categoriesList.find(c => c.slug === p.tag_personalizacao);
                    const displayTag = catObj ? catObj.nome : (p.tag_personalizacao || 'Streetwear');

                    container.innerHTML += `
                        <a href="product-detail.html?id=${p.id}" class="product-card-link" style="text-decoration: none; color: inherit;">
                            <div class="product-card" 
                                 data-subtag="${(p.tag_personalizacao || '').toLowerCase()}"
                                 onmouseenter="startRotation(this)" 
                                 onmouseleave="stopRotation(this)">
                                <div class="image-container">
                                    <span class="card-tag">${displayTag}</span>
                                    ${imagensHtml}
                                </div>
                                <div class="card-content">
                                    <h3 class="card-title">${p.nome}</h3>
                                    <span class="card-tap-info">Ver Detalhes →</span>
                                </div>
                            </div>
                        </a>
                    `;
                });
            } catch (err) {
                container.innerHTML = '<p style="color: red; text-align: center; grid-column: 1/-1;">Erro ao carregar dados.</p>';
            }
        }

        // --- FUNÇÕES AUXILIARES ---

        function startRotation(card) {
            const images = card.querySelectorAll('.card-image');
            if (images.length <= 1) return;
            let currentIndex = 0;
            clearInterval(rotationInterval);
            rotationInterval = setInterval(() => {
                images[currentIndex].classList.remove('active');
                currentIndex = (currentIndex + 1) % images.length;
                images[currentIndex].classList.add('active');
            }, 1000);
        }

        function stopRotation(card) {
            clearInterval(rotationInterval);
            const images = card.querySelectorAll('.card-image');
            images.forEach((img, index) => {
                img.classList.remove('active');
                if (index === 0) img.classList.add('active');
            });
        }

        function filterProducts(slug, event) {
            const cards = document.querySelectorAll('.product-card-link');
            const btns = document.querySelectorAll('.filter-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            cards.forEach(card => {
                const item = card.querySelector('.product-card');
                const tag = item.getAttribute('data-subtag');
                card.style.display = (slug === 'all' || tag === slug.toLowerCase()) ? 'block' : 'none';
            });
        }

        async function loadClientLogos() {
            const track = document.getElementById('logo-track');
            if (!track) return;
            try {
                const { data } = await _supabase.from('site_config').select('*').eq('id', 'client_logos').maybeSingle();
                const config = data ? data.data : { brand_logos: [] };
                const logos = config.brand_logos || [];

                if (logos.length === 0) {
                    document.querySelector('.clients-section').style.display = 'none';
                    return;
                }

                track.innerHTML = logos.map(url => `
                    <div class="client-item">
                        <img src="${url}" alt="Logo Parceiro">
                    </div>
                `).join('');
            } catch (e) { console.error("Erro logos:", e); }
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderCatalog();
            loadClientLogos();
        });

        document.addEventListener('keydown', (e) => {
            if (e.shiftKey && (e.key === 'L' || e.key === 'l')) {
                window.location.href = 'admin.html';
            }
        });
    </script>
</body>

</html>